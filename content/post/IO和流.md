# 流与IO

## .NET流的架构

主要包含三个概念：后台存储、装饰器以及流适配器。

![image-20220129163036495](D:\Hugo_blog\static\images\image-20220129163036495.png)

后台存储是输入输出的终结点，例如文件或者网络连接。准确地说，它可以是以下的一种或者两种：

- 支持顺序读取字节的源。
- 支持顺序写入字节的目标。

使用后台存储，必须公开相应的接口。而`Stream`正是实现这个功能的`.NET`标准类。它支持标准的读、写以及定位方法。它与数组不同，流并不会直接将数据存储在内存中，流会以每次一个字节或者每次一块数据的方式按照序列处理数据。

流可以分为两类：

1. **后台存储流**：它们是与特定的后台存储类型连接的流，例如FileStream或者NetworkStream。

2. **装饰器流**：这些流会使用其他的流，并以某种方式转换数据。例如DeflateStream或者CryptoStream。

后台存储流和装饰器流仅支持字节处理。虽然这种方式灵活又高效，但应用程序往往需要处理更高层次的数据，例如文本或者XML。适配器正好弥补了这个鸿沟。它在类中创建专门的方法以支持特定的格式。例如，`TextReader`有一个`ReadLine`方法，而`XmlTextWriter`则拥有`WriteAttribute`方法。

## 使用流

抽象的Stream类是所有流的基类。它的方法和属性定义了三种基本的操作：读、写、查找。除此之外，它还定义了一些管理性的任务，例如关闭、刷新（flush）和配置超时时间。

![image-20220129164951303](D:\Hugo_blog\static\images\image-20220129164951303.png)
